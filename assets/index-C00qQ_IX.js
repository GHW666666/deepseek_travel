import{m as E,n as I,p as $,q as M,s as q,v as H,h as U,g as R,l as F,d as n,x as z,y as G,P as K,I as Q,L as W,z as X,A as j,B as Y,C as Z,D as ee,r as v,E as te,G as se,H as oe,_ as ae,J as ne,c as le,a as p,e as k,w as S,u as re,o as ie,f as ce}from"./index-D7aTmjxr.js";let h=0;function ue(e){e?(h||document.body.classList.add("van-toast--unclickable"),h++):h&&(h--,h||document.body.classList.remove("van-toast--unclickable"))}const[de,C]=H("toast"),me=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],pe={icon:String,show:Boolean,type:M("text"),overlay:Boolean,message:I,iconSize:I,duration:q(2e3),position:M("middle"),teleport:[String,Object],wordBreak:String,className:$,iconPrefix:String,transition:M("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:$,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:I};var D=E({name:de,props:pe,emits:["update:show"],setup(e,{emit:o,slots:a}){let i,s=!1;const m=()=>{const u=e.show&&e.forbidClick;s!==u&&(s=u,ue(s))},c=u=>o("update:show",u),f=()=>{e.closeOnClick&&c(!1)},g=()=>clearTimeout(i),b=()=>{const{icon:u,type:d,iconSize:x,iconPrefix:r,loadingType:t}=e;if(u||d==="success"||d==="fail")return n(Q,{name:u||d,size:x,class:C("icon"),classPrefix:r},null);if(d==="loading")return n(W,{class:C("loading"),size:x,type:t},null)},P=()=>{const{type:u,message:d}=e;if(a.message)return n("div",{class:C("text")},[a.message()]);if(X(d)&&d!=="")return u==="html"?n("div",{key:0,class:C("text"),innerHTML:String(d)},null):n("div",{class:C("text")},[d])};return U(()=>[e.show,e.forbidClick],m),U(()=>[e.show,e.type,e.message,e.duration],()=>{g(),e.show&&e.duration>0&&(i=setTimeout(()=>{c(!1)},e.duration))}),R(m),F(m),()=>n(K,z({class:[C([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:f,onClosed:g,"onUpdate:show":c},G(e,me)),{default:()=>[b(),P()]})}});const fe={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let V=[],ve=!1,L=j({},fe);const ge=new Map;function _(e){return Z(e)?e:{message:e}}function ye(){const{instance:e}=ee({setup(){const o=v(""),{open:a,state:i,close:s,toggle:m}=te(),c=()=>{},f=()=>n(D,z(i,{onClosed:c,"onUpdate:show":m}),null);return U(o,g=>{i.message=g}),se().render=f,{open:a,close:s,message:o}}});return e}function Ce(){if(!V.length||ve){const e=ye();V.push(e)}return V[V.length-1]}function we(e={}){if(!Y)return{};const o=Ce(),a=_(e);return o.open(j({},L,ge.get(a.type||L.type),a)),o}const A=e=>o=>we(j({type:e},_(o))),ke=A("success"),w=A("fail");oe(D);const O="http://localhost:7000",he={async submit(e){try{const a=await(await fetch(`${O}/complaint/submit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return a.code===200?{success:!0,data:a.data,message:a.message}:{success:!1,message:a.message}}catch(o){return console.error("提交投诉失败:",o),{success:!1,message:"网络错误，请稍后重试"}}},async getList(){try{const o=await(await fetch(`${O}/complaint/list`)).json();return o.code===200?{success:!0,data:o.data,message:o.message}:{success:!1,message:o.message}}catch(e){return console.error("获取投诉列表失败:",e),{success:!1,message:"网络错误，请稍后重试"}}},async getDetail(e){try{const a=await(await fetch(`${O}/complaint/detail`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).json();return a.code===200?{success:!0,data:a.data,message:a.message}:{success:!1,message:a.message}}catch(o){return console.error("获取投诉详情失败:",o),{success:!1,message:"网络错误，请稍后重试"}}},async updateStatus(e,o){try{const i=await(await fetch(`${O}/complaint/updateStatus`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,status:o})})).json();return i.code===200?{success:!0,data:i.data,message:i.message}:{success:!1,message:i.message}}catch(a){return console.error("更新投诉状态失败:",a),{success:!1,message:"网络错误，请稍后重试"}}}},be={class:"complaint-page"},xe={class:"complaint-page"},Se={class:"complaint-page"},Ve={class:"complaint-page"},Oe={class:"complaint-page"},Pe={__name:"index",setup(e){const o=re(),a=v(!1),i=()=>{o.push("/")},s=ne({name:"",phone:"",target:"",reason:"",location:"",demand:"",travelMethod:""});v(""),v(""),v("");const m=v(!1),c=v(!1),f=v(!1),g=[{text:"自由行",value:"自由行"},{text:"跟团游",value:"跟团游"}],b=[{text:"昆明",value:"昆明"},{text:"大理",value:"大理"},{text:"丽江",value:"丽江"},{text:"香格里拉",value:"香格里拉"},{text:"西双版纳",value:"西双版纳"}],P=({selectedOptions:r})=>{m.value=!1,s.target=r[0].text},u=({selectedOptions:r})=>{c.value=!1,s.location=r[0].text},d=({selectedOptions:r})=>{f.value=!1,s.travelMethod=r[0].text},x=async()=>{if(!s.name.trim()){w("请输入姓名");return}if(!s.phone.trim()){w("请输入电话号码");return}if(!s.target.trim()){w("请选择投诉对象");return}if(!s.reason.trim()){w("请输入投诉原因");return}a.value=!0;try{const r=await he.submit({name:s.name,phone:s.phone,target:s.target,reason:s.reason,location:s.location,demand:s.demand,travelMethod:s.travelMethod});r.success?(ke("投诉提交成功"),setTimeout(()=>{o.push("/")},1500)):w(r.message||"提交失败")}catch(r){console.error("提交投诉失败:",r),w("网络错误，请稍后重试")}finally{a.value=!1}};return(r,t)=>{const N=k("van-nav-bar"),y=k("van-field"),T=k("van-picker"),B=k("van-popup"),J=k("van-button");return ie(),le("div",null,[n(N,{title:"投诉","left-arrow":"",fixed:"",placeholder:"false",onClickLeft:i}),p("div",be,[t[14]||(t[14]=p("p",{class:"title-text"},"你要投诉谁",-1)),n(y,{modelValue:s.target,"onUpdate:modelValue":t[0]||(t[0]=l=>s.target=l),"is-link":"",readonly:"",label:"投诉",placeholder:"选择投诉对象",onClick:t[1]||(t[1]=l=>m.value=!0)},null,8,["modelValue"]),n(B,{show:m.value,round:"",position:"bottom"},{default:S(()=>[n(T,{columns:b,onCancel:t[2]||(t[2]=l=>m.value=!1),onConfirm:P})]),_:1},8,["show"])]),p("div",xe,[t[15]||(t[15]=p("p",{class:"title-text"},"请告诉我们发生了什么事",-1)),n(y,{modelValue:s.reason,"onUpdate:modelValue":t[3]||(t[3]=l=>s.reason=l),class:"input-text",type:"textarea",placeholder:"请输入投诉原因"},null,8,["modelValue"])]),p("div",Se,[t[16]||(t[16]=p("p",{class:"title-text"},"这件事发生在哪里",-1)),n(y,{modelValue:s.location,"onUpdate:modelValue":t[4]||(t[4]=l=>s.location=l),"is-link":"",readonly:"",label:"投诉",placeholder:"选择投诉地区",onClick:t[5]||(t[5]=l=>c.value=!0)},null,8,["modelValue"]),n(B,{show:c.value,"onUpdate:show":t[7]||(t[7]=l=>c.value=l),round:"",position:"bottom"},{default:S(()=>[n(T,{columns:b,onCancel:t[6]||(t[6]=l=>c.value=!1),onConfirm:u})]),_:1},8,["show"])]),p("div",Ve,[t[17]||(t[17]=p("p",{class:"title-text"},"你的诉求是",-1)),n(y,{modelValue:s.demand,"onUpdate:modelValue":t[8]||(t[8]=l=>s.demand=l),class:"input-text",type:"textarea",placeholder:"点击输入"},null,8,["modelValue"])]),p("div",Oe,[t[18]||(t[18]=p("p",{class:"title-text"}," 最后我们需要了解您的个人信息，用于核实事件以及告知 ",-1)),n(y,{modelValue:s.name,"onUpdate:modelValue":t[9]||(t[9]=l=>s.name=l),label:"你的姓名",placeholder:"请输入姓名"},null,8,["modelValue"]),n(y,{modelValue:s.phone,"onUpdate:modelValue":t[10]||(t[10]=l=>s.phone=l),type:"tel",label:"你的联系方式",placeholder:"请输入电话号码"},null,8,["modelValue"]),n(y,{modelValue:s.travelMethod,"onUpdate:modelValue":t[11]||(t[11]=l=>s.travelMethod=l),"is-link":"",readonly:"",placeholder:"你在云南是如何旅行的",onClick:t[12]||(t[12]=l=>f.value=!0)},null,8,["modelValue"]),n(B,{show:f.value,round:"",position:"bottom"},{default:S(()=>[n(T,{columns:g,onCancel:t[13]||(t[13]=l=>f.value=!1),onConfirm:d})]),_:1},8,["show"])]),n(J,{class:"submit-button",type:"primary",onClick:x,loading:a.value},{default:S(()=>[...t[19]||(t[19]=[ce("提交投诉",-1)])]),_:1},8,["loading"])])}}},Be=ae(Pe,[["__scopeId","data-v-d169bfb0"]]);export{Be as default};
