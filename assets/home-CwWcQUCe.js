import{_ as M,c as h,o as w,a as g,b as j,r as z,d as v,e as S,w as b,u as R,f as T,g as B,h as J,F as H,i as L,j as N,t as P,k as q,l as U}from"./index-D7aTmjxr.js";const C="/deepseek_travel/assets/%E7%8C%AB-nHbXJ-ix.jpg",W={};function D(m,e){return w(),h("div",null,[...e[0]||(e[0]=[g("div",{class:"main-header"},[g("div",null,[g("p",{class:"name-field"},"Hi,我是云游小助手"),g("p",{class:"intro-section"},"你的江西专属云游助手，可以帮你规划行程和解答出游问题哦")]),g("div",null,[g("img",{src:C,alt:""})])],-1)])])}const F=M(W,[["render",D]]),x="/deepseek_travel/assets/%E5%A4%B4%E5%83%8F-CEvM-Wqj.jpg",G={};function K(m,e){return w(),h("div",null,[...e[0]||(e[0]=[j('<div class="support-agent" data-v-aeb76c9d><img src="'+x+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>云游宝</p></div><div class="customer-service" data-v-aeb76c9d><span data-v-aeb76c9d>你可以这样问我</span><div class="custome-service-list" data-v-aeb76c9d><img src="'+x+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>你好，你能做什么</p></div><div class="custome-service-list" data-v-aeb76c9d><img src="'+x+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>你好，帮我查询上海1.1号的天气</p></div><div class="custome-service-list" data-v-aeb76c9d><img src="'+x+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>你好，帮我查询1.12号从上海到赣州的火车票</p></div></div><div class="change-section" data-v-aeb76c9d><p data-v-aeb76c9d>换一换</p></div>',3)])])}const Q=M(G,[["render",K],["__scopeId","data-v-aeb76c9d"]]),A="http://localhost:7000",I={async queryTrainTickets(m,e){try{const a={start:m,end:e};console.log("前端发送火车票查询请求:",{url:`${A}/tool/trainTickets`,body:a});const n=await fetch(`${A}/tool/trainTickets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();return console.log("前端收到火车票查询响应:",i),i}catch(a){throw console.error("查询火车票失败:",a),a}},async getWeather(m){try{const e=await fetch(`${A}/tool/weather`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({city:m})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw console.error("查询天气失败:",e),e}}},X="http://localhost:7000",Y={async sendToBackend(m,e){try{const a=await fetch(`${X}/chatMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatMessage:m})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const n=a.body.getReader(),i=new TextDecoder;let c="";for(;;){const{done:_,value:r}=await n.read();if(_)break;const s=i.decode(r).split(`
`).filter(f=>f.trim());for(const f of s)try{const o=JSON.parse(f);if(o.type==="content")c+=o.data,e&&e(o.data);else if(o.type==="function"){if(console.log("工具调用:",o.functionName,o.data),console.log("工具调用数据详情:",JSON.stringify(o.data,null,2)),o.functionName==="trainTickets"){const{departure:y,destination:l}=o.data;console.log("解构后的参数:",{start:y,end:l,startType:typeof y,endType:typeof l}),console.log("调用火车票查询API:",y,l);try{const p=await I.queryTrainTickets(y,l);console.log("火车票查询结果:",p);let d=`火车票查询结果：

`;if(p&&p.data&&p.data.list){const E=p.data.list;d+=`找到 ${E.length} 趟火车票：

`,E.forEach((t,O)=>{d+=`${O+1}. ${t.trainno} (${t.type})
`,d+=`   ${t.departstation} ${t.departuretime} → ${t.terminalstation} ${t.arrivaltime}
`,d+=`   用时：${t.costtime}
`;const $=[];t.yz&&t.yz.price!=="--"&&$.push(`硬座 ¥${t.yz.price}`),t.ze&&t.ze.price!=="--"&&$.push(`二等座 ¥${t.ze.price}`),t.zy&&t.zy.price!=="--"&&$.push(`一等座 ¥${t.zy.price}`),t.swz&&t.swz.price!=="--"&&$.push(`商务座 ¥${t.swz.price}`),t.yw&&t.yw.price!=="--"&&$.push(`硬卧 ¥${t.yw.price}`),t.rw&&t.rw.price!=="--"&&$.push(`软卧 ¥${t.rw.price}`),$.length>0&&(d+=`   票价：${$.join("、")}
`),d+=`
`})}else d="未查询到符合条件的火车票";e&&e(d)}catch(p){console.error("查询火车票失败:",p),e&&e("查询火车票失败，请稍后重试")}}else if(o.functionName==="getWeather"){const{city:y}=o.data;console.log("调用天气查询API:",y);try{const l=await I.getWeather(y);console.log("天气查询结果:",l);let p=`天气查询结果：
`;if(l&&l.data){const d=l.data;p+=`${d.city} ${d.temperature} ${d.weather}
`,p+=`风力：${d.wind}
`,p+=`湿度：${d.humidity}`}else p="查询天气失败";e&&e(p)}catch(l){console.error("查询天气失败:",l),e&&e("查询天气失败，请稍后重试")}}}}catch(o){console.error("解析错误:",o)}}return c}catch(a){throw console.error("发送消息失败:",a),a}}},Z={class:"input-container"},k={class:"data-query"},ee={class:"input-box-area"},te={__name:"inputArea",emits:["send-message"],setup(m,{emit:e}){const a=e,n=R(),i=z([]),c=z(""),_=()=>{n.push("/complaintPage")},r=async()=>{if(!c.value.trim())return;const u=c.value;c.value="",a("send-message",{type:"user",content:u});try{console.log("开始发送消息到后端..."),await Y.sendToBackend([{role:"user",content:u}],s=>{console.log("接收到流式数据块:",s),a("send-message",{type:"ai",content:s}),console.log("AI消息块已发送到前端")}),console.log("流式数据发送完成")}catch(s){console.error("发送消息到后端失败:",s)}};return(u,s)=>{const f=S("van-uploader"),o=S("van-button"),y=S("van-field");return w(),h("div",Z,[v(f,{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=l=>i.value=l),"max-count":1,"preview-size":"60",disabled:""},null,8,["modelValue"]),g("div",k,[v(o,{size:"small",type:"default"},{default:b(()=>[...s[2]||(s[2]=[T("查询火车票",-1)])]),_:1}),v(o,{size:"small",type:"default"},{default:b(()=>[...s[3]||(s[3]=[T("查询天气",-1)])]),_:1}),v(f,null,{default:b(()=>[v(o,{size:"small",type:"default"},{default:b(()=>[...s[4]||(s[4]=[T("上传文件",-1)])]),_:1})]),_:1}),v(o,{size:"small",type:"default",onClick:_},{default:b(()=>[...s[5]||(s[5]=[T("一键投诉",-1)])]),_:1})]),g("div",ee,[v(y,{modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=l=>c.value=l),class:"input-content",type:"textarea",placeholder:"请输入询问内容",border:!1},null,8,["modelValue"]),v(o,{class:"send-button",size:"small",type:"default",onClick:r},{default:b(()=>[...s[6]||(s[6]=[T("发送",-1)])]),_:1})])])}}},se=M(te,[["__scopeId","data-v-11b25d40"]]),ae={class:"chat-message"},oe={key:0,class:"user-message-container"},ne={class:"user-message"},re={key:1,class:"ai-message"},ce={class:"mark-text"},V="chat_messages",le={__name:"chatMessage",emits:["messages-change"],setup(m,{expose:e,emit:a}){const n=z([]),i=a;B(()=>{const r=localStorage.getItem(V);if(r)try{n.value=JSON.parse(r)}catch(u){console.error("读取历史消息失败:",u)}}),J(n,()=>{i("messages-change")});const c=r=>{if(console.log("addMessage 被调用"),console.log("接收到的消息:",r),r.type==="user")n.value.push(r);else if(r.type==="ai"){const u=n.value[n.value.length-1];u&&u.type==="ai"?u.content+=r.content:n.value.push(r)}else r.type==="function"&&n.value.push(r);console.log("当前消息列表:",n.value),_()},_=()=>{try{localStorage.setItem(V,JSON.stringify(n.value))}catch(r){console.error("保存消息失败:",r)}};return e({addMessage:c}),(r,u)=>{const s=S("van-image");return w(),h("div",ae,[(w(!0),h(H,null,L(n.value,(f,o)=>(w(),h("div",{key:o},[f.type==="user"?(w(),h("div",oe,[g("div",ne,[g("p",null,P(f.content),1)]),v(s,{class:"user-avatar",width:"40px",height:"40px",radius:"50%",fit:"cover",src:q(x)},null,8,["src"])])):N("",!0),f.type==="ai"?(w(),h("div",re,[g("div",ce,P(f.content),1)])):N("",!0)]))),128))])}}},ie=M(le,[["__scopeId","data-v-7d344036"]]),de={__name:"home",setup(m){const e=z(null),a=z(null),n=c=>{e.value?(console.log("调用 addMessage"),e.value.addMessage(c)):console.error("chatMessageRef 为空")},i=()=>{var c,_;if(a.value){const r=((_=(c=e.value)==null?void 0:c.$el)==null?void 0:_.scrollHeight)||0,u=Math.max(200,r+50);a.value.style.paddingBottom=`${u}px`}};return B(()=>{i(),window.addEventListener("resize",i)}),U(()=>{window.removeEventListener("resize",i)}),(c,_)=>(w(),h("div",{class:"content",ref_key:"contentRef",ref:a},[v(F),v(Q),v(ie,{ref_key:"chatMessageRef",ref:e,onMessagesChange:i},null,512),v(se,{onSendMessage:n})],512))}},pe=M(de,[["__scopeId","data-v-4e3abc62"]]);export{pe as default};
