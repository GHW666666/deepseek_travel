import{d as G,t as z,c as Y,r as D,u as be,a as _e,b as l,w as Z,e as $,f as Ce,g as Te,h as ee,i as Pe,B as W,j as Ie,k as xe,l as De,m as me,p as Se,n as Ee,o as $e,P as Me,q as Ae,s as Oe,v as Ne,x as ze,y as te,z as Le,A as Re,C as ke,D as Ve,E as je,F as Fe,G as He,_ as M,H as _,I as C,J as b,K as We,L as Ke,M as he,N as Ue,O as Je,Q as ne,R as L,S as se,T as oe,U as P,V as qe,W as x,X as Qe}from"./index-BmxogOyr.js";import{s as Xe}from"./index-COYSASPr.js";const[ge,ae]=Y("action-bar"),pe=Symbol(ge),Ge={placeholder:Boolean,safeAreaInsetBottom:z};var Ye=G({name:ge,props:Ge,setup(e,{slots:t}){const n=D(),o=be(n,ae),{linkChildren:a}=_e(pe);a();const i=()=>{var r;return l("div",{ref:n,class:[ae(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(r=t.default)==null?void 0:r.call(t)])};return()=>e.placeholder?o(i):i()}});const Ze=Z(Ye),[et,tt]=Y("action-bar-button"),nt=$({},Ie,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var st=G({name:et,props:nt,setup(e,{slots:t}){const n=Ce(),{parent:o,index:a}=Te(pe),i=ee(()=>{if(o){const u=o.children[a.value-1];return!(u&&"isButton"in u)}}),r=ee(()=>{if(o){const u=o.children[a.value+1];return!(u&&"isButton"in u)}});return Pe({isButton:!0}),()=>{const{type:u,icon:d,text:f,color:v,loading:c,disabled:w}=e;return l(W,{class:tt([u,{last:r.value,first:i.value}]),size:"large",type:u,icon:d,color:v,loading:c,disabled:w,onClick:n},{default:()=>[t.default?t.default():f]})}}});const re=Z(st),[ot,B,N]=Y("dialog"),at=$({},Ae,{title:String,theme:String,width:ze,message:[String,Function],callback:Function,allowHtml:Boolean,className:Ne,transition:Oe("van-dialog-bounce"),messageAlign:String,closeOnPopstate:z,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:z,closeOnClickOverlay:Boolean,keyboardEnabled:z,destroyOnClose:Boolean}),rt=[...Ee,"transition","closeOnPopstate","destroyOnClose"];var ye=G({name:ot,props:at,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:t,slots:n}){const o=D(),a=xe({confirm:!1,cancel:!1}),i=s=>t("update:show",s),r=s=>{var y;i(!1),(y=e.callback)==null||y.call(e,s)},u=s=>()=>{e.show&&(t(s),e.beforeClose?(a[s]=!0,Ve(e.beforeClose,{args:[s],done(){r(s),a[s]=!1},canceled(){a[s]=!1}})):r(s))},d=u("cancel"),f=u("confirm"),v=De(s=>{var y,p;if(!e.keyboardEnabled||s.target!==((p=(y=o.value)==null?void 0:y.popupRef)==null?void 0:p.value))return;({Enter:e.showConfirmButton?f:te,Escape:e.showCancelButton?d:te})[s.key](),t("keydown",s)},["enter","esc"]),c=()=>{const s=n.title?n.title():e.title;if(s)return l("div",{class:B("header",{isolated:!e.message&&!n.default})},[s])},w=s=>{const{message:y,allowHtml:p,messageAlign:T}=e,O=B("message",{"has-title":s,[T]:T}),k=Le(y)?y():y;return p&&typeof k=="string"?l("div",{class:O,innerHTML:k},null):l("div",{class:O},[k])},h=()=>{if(n.default)return l("div",{class:B("content")},[n.default()]);const{title:s,message:y,allowHtml:p}=e;if(y){const T=!!(s||n.title);return l("div",{key:p?1:0,class:B("content",{isolated:!T})},[w(T)])}},g=()=>l("div",{class:[ke,B("footer")]},[e.showCancelButton&&l(W,{size:"large",text:e.cancelButtonText||N("cancel"),class:B("cancel"),style:{color:e.cancelButtonColor},loading:a.cancel,disabled:e.cancelButtonDisabled,onClick:d},null),e.showConfirmButton&&l(W,{size:"large",text:e.confirmButtonText||N("confirm"),class:[B("confirm"),{[Re]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:a.confirm,disabled:e.confirmButtonDisabled,onClick:f},null)]),m=()=>l(Ze,{class:B("footer")},{default:()=>[e.showCancelButton&&l(re,{type:"warning",text:e.cancelButtonText||N("cancel"),class:B("cancel"),color:e.cancelButtonColor,loading:a.cancel,disabled:e.cancelButtonDisabled,onClick:d},null),e.showConfirmButton&&l(re,{type:"danger",text:e.confirmButtonText||N("confirm"),class:B("confirm"),color:e.confirmButtonColor,loading:a.confirm,disabled:e.confirmButtonDisabled,onClick:f},null)]}),A=()=>n.footer?n.footer():e.theme==="round-button"?m():g();return()=>{const{width:s,title:y,theme:p,message:T,className:O}=e;return l(Me,me({ref:o,role:"dialog",class:[B([p]),O],style:{width:$e(s)},tabindex:0,"aria-labelledby":y||T,onKeydown:v,"onUpdate:show":i},Se(e,rt)),{default:()=>[c(),h(),A()]})}}});let K;const ct={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1,destroyOnClose:!1};let it=$({},ct);function lt(){({instance:K}=Fe({setup(){const{state:t,toggle:n}=He();return()=>l(ye,me(t,{"onUpdate:show":n}),null)}}))}function dt(e){return je?new Promise((t,n)=>{K||lt(),K.open($({},it,e,{callback:o=>{(o==="confirm"?t:n)(o)}}))}):Promise.resolve(void 0)}const ut=e=>dt($({showCancelButton:!0},e));Z(ye);const ft="/deepseek_travel/assets/%E7%8C%AB-nHbXJ-ix.jpg",mt={};function ht(e,t){return C(),_("div",null,[...t[0]||(t[0]=[b("div",{class:"main-header"},[b("div",null,[b("p",{class:"name-field"},"Hi,我是云游小助手"),b("p",{class:"intro-section"},"你的江西专属云游助手，可以帮你规划行程和解答出游问题哦")]),b("div",null,[b("img",{src:ft,alt:""})])],-1)])])}const gt=M(mt,[["render",ht]]),S="/deepseek_travel/assets/%E5%A4%B4%E5%83%8F-CEvM-Wqj.jpg",pt={};function yt(e,t){return C(),_("div",null,[...t[0]||(t[0]=[We('<div class="support-agent" data-v-aeb76c9d><img src="'+S+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>云游宝</p></div><div class="customer-service" data-v-aeb76c9d><span data-v-aeb76c9d>你可以这样问我</span><div class="custome-service-list" data-v-aeb76c9d><img src="'+S+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>你好，你能做什么</p></div><div class="custome-service-list" data-v-aeb76c9d><img src="'+S+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>你好，帮我查询上海1.1号的天气</p></div><div class="custome-service-list" data-v-aeb76c9d><img src="'+S+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>你好，帮我查询1.12号从上海到赣州的火车票</p></div></div><div class="change-section" data-v-aeb76c9d><p data-v-aeb76c9d>换一换</p></div>',3)])])}const vt=M(pt,[["render",yt],["__scopeId","data-v-aeb76c9d"]]),U=(e,t)=>t.some(n=>e instanceof n);let ce,ie;function wt(){return ce||(ce=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Bt(){return ie||(ie=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const J=new WeakMap,V=new WeakMap,R=new WeakMap;function bt(e){const t=new Promise((n,o)=>{const a=()=>{e.removeEventListener("success",i),e.removeEventListener("error",r)},i=()=>{n(I(e.result)),a()},r=()=>{o(e.error),a()};e.addEventListener("success",i),e.addEventListener("error",r)});return R.set(t,e),t}function _t(e){if(J.has(e))return;const t=new Promise((n,o)=>{const a=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",r),e.removeEventListener("abort",r)},i=()=>{n(),a()},r=()=>{o(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",i),e.addEventListener("error",r),e.addEventListener("abort",r)});J.set(e,t)}let q={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return J.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return I(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function ve(e){q=e(q)}function Ct(e){return Bt().includes(e)?function(...t){return e.apply(Q(this),t),I(this.request)}:function(...t){return I(e.apply(Q(this),t))}}function Tt(e){return typeof e=="function"?Ct(e):(e instanceof IDBTransaction&&_t(e),U(e,wt())?new Proxy(e,q):e)}function I(e){if(e instanceof IDBRequest)return bt(e);if(V.has(e))return V.get(e);const t=Tt(e);return t!==e&&(V.set(e,t),R.set(t,e)),t}const Q=e=>R.get(e);function Pt(e,t,{blocked:n,upgrade:o,blocking:a,terminated:i}={}){const r=indexedDB.open(e,t),u=I(r);return o&&r.addEventListener("upgradeneeded",d=>{o(I(r.result),d.oldVersion,d.newVersion,I(r.transaction),d)}),n&&r.addEventListener("blocked",d=>n(d.oldVersion,d.newVersion,d)),u.then(d=>{i&&d.addEventListener("close",()=>i()),a&&d.addEventListener("versionchange",f=>a(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const It=["get","getKey","getAll","getAllKeys","count"],xt=["put","add","delete","clear"],j=new Map;function le(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(j.get(t))return j.get(t);const n=t.replace(/FromIndex$/,""),o=t!==n,a=xt.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(a||It.includes(n)))return;const i=async function(r,...u){const d=this.transaction(r,a?"readwrite":"readonly");let f=d.store;return o&&(f=f.index(u.shift())),(await Promise.all([f[n](...u),a&&d.done]))[0]};return j.set(t,i),i}ve(e=>({...e,get:(t,n,o)=>le(t,n)||e.get(t,n,o),has:(t,n)=>!!le(t,n)||e.has(t,n)}));const Dt=["continue","continuePrimaryKey","advance"],de={},X=new WeakMap,we=new WeakMap,St={get(e,t){if(!Dt.includes(t))return e[t];let n=de[t];return n||(n=de[t]=function(...o){X.set(this,we.get(this)[t](...o))}),n}};async function*Et(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,St);for(we.set(n,t),R.set(n,Q(t));t;)yield n,t=await(X.get(n)||t.continue()),X.delete(n)}function ue(e,t){return t===Symbol.asyncIterator&&U(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&U(e,[IDBIndex,IDBObjectStore])}ve(e=>({...e,get(t,n,o){return ue(t,n)?Et:e.get(t,n,o)},has(t,n){return ue(t,n)||e.has(t,n)}}));const $t="travel-chat-db",E="messages",Mt=1;async function F(){return Pt($t,Mt,{upgrade(e){e.objectStoreNames.contains(E)||e.createObjectStore(E,{keyPath:"timestamp"})}})}const Be=Ke("chat",{state:()=>({messages:[]}),actions:{async init(){const t=await(await F()).getAll(E);this.messages=t.sort((n,o)=>(n.timestamp||0)-(o.timestamp||0))},async addMessage(e){const t={...e,timestamp:Date.now()};if(e.type==="user")this.messages.push(t);else if(e.type==="ai"){const n=this.messages[this.messages.length-1];n&&n.type==="ai"?n.content+=e.content:this.messages.push(t)}else e.type==="function"&&this.messages.push(t);await this.saveToDB(t)},async saveToDB(e){await(await F()).put(E,e)},async clearMessages(){await(await F()).clear(E),this.messages=[]}}}),At={class:"chat-message"},Ot={key:0,class:"user-message-container"},Nt={class:"user-message"},zt={key:1,class:"ai-message"},Lt={class:"mark-text"},Rt={__name:"chatMessage",emits:["messages-change"],setup(e,{expose:t,emit:n}){const o=Be(),a=n;return he(async()=>{await o.init(),a("messages-change")}),t({addMessage:async r=>{await o.addMessage(r),a("messages-change")}}),(r,u)=>{const d=L("van-image");return C(),_("div",At,[(C(!0),_(Ue,null,Je(ne(o).messages,(f,v)=>(C(),_("div",{key:v},[f.type==="user"?(C(),_("div",Ot,[b("div",Nt,[b("p",null,oe(f.content),1)]),l(d,{class:"user-avatar",width:"40px",height:"40px",radius:"50%",fit:"cover",src:ne(S)},null,8,["src"])])):se("",!0),f.type==="ai"?(C(),_("div",zt,[b("div",Lt,oe(f.content),1)])):se("",!0)]))),128))])}}},kt=M(Rt,[["__scopeId","data-v-619464db"]]),H="http://localhost:7000",fe={async queryTrainTickets(e,t){try{const n={start:e,end:t};console.log("前端发送火车票查询请求:",{url:`${H}/tool/trainTickets`,body:n});const o=await fetch(`${H}/tool/trainTickets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();return console.log("前端收到火车票查询响应:",a),a}catch(n){throw console.error("查询火车票失败:",n),n}},async getWeather(e){try{const t=await fetch(`${H}/tool/weather`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({city:e})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){throw console.error("查询天气失败:",t),t}}},Vt="http://localhost:7000",jt={async sendToBackend(e,t){try{const n=await fetch(`${Vt}/chatMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatMessage:e})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=n.body.getReader(),a=new TextDecoder;let i="";for(;;){const{done:r,value:u}=await o.read();if(r)break;const f=a.decode(u).split(`
`).filter(v=>v.trim());for(const v of f)try{const c=JSON.parse(v);if(c.type==="content")i+=c.data,t&&t(c.data);else if(c.type==="function"){if(console.log("收到工具调用:",c.functionName,c.data),c.functionName==="trainTickets"){const{departure:w,destination:h}=c.data;console.log("调用火车票查询API:",w,h);try{const g=await fe.queryTrainTickets(w,h);console.log("火车票查询结果:",g);let m="";if(g&&g.data&&g.data.list){const A=g.data.list;m+=`找到 ${A.length} 趟火车票：

`,A.forEach((s,y)=>{m+=`${y+1}. ${s.trainno} (${s.type})
`,m+=`   ${s.departstation} ${s.departuretime} → ${s.terminalstation} ${s.arrivaltime}
`,m+=`   用时：${s.costtime}
`;const p=[];s.yz&&s.yz.price!=="--"&&p.push(`硬座 ¥${s.yz.price}`),s.ze&&s.ze.price!=="--"&&p.push(`二等座 ¥${s.ze.price}`),s.zy&&s.zy.price!=="--"&&p.push(`一等座 ¥${s.zy.price}`),s.swz&&s.swz.price!=="--"&&p.push(`商务座 ¥${s.swz.price}`),s.yw&&s.yw.price!=="--"&&p.push(`硬卧 ¥${s.yw.price}`),s.rw&&s.rw.price!=="--"&&p.push(`软卧 ¥${s.rw.price}`),p.length>0&&(m+=`   票价：${p.join("、")}
`),m+=`
`})}else m="未查询到符合条件的火车票";t&&t(m)}catch(g){console.error("查询火车票失败:",g),t&&t("查询火车票失败，请稍后重试")}}else if(c.functionName==="getWeather"){const{city:w}=c.data;console.log("调用天气查询API:",w);try{const h=await fe.getWeather(w);console.log("天气查询结果:",h);let g="";if(h&&h.data){const m=h.data;g+=`${m.city} ${m.temperature} ${m.weather}
`,g+=`风力：${m.wind}
`,g+=`湿度：${m.humidity}`}else g="查询天气失败";t&&t(g)}catch(h){console.error("查询天气失败:",h),t&&t("查询天气失败，请稍后重试")}}}}catch(c){console.error("解析错误:",c)}}return i}catch(n){throw console.error("发送消息失败:",n),n}}},Ft={class:"input-container"},Ht={class:"data-query"},Wt={class:"input-box-area"},Kt={__name:"inputArea",emits:["send-message"],setup(e,{emit:t}){const n=t,o=qe(),a=Be(),i=D([]),r=D(""),u=()=>{o.push("/complaintPage")},d=async()=>{try{await ut({title:"确认清空",message:"确定要清空所有聊天记录吗？"}),await a.clearMessages(),Xe("历史记录已清空"),n("send-message",{type:"clear",content:""})}catch{}},f=async()=>{if(!r.value.trim())return;const v=r.value;r.value="",n("send-message",{type:"user",content:v});try{console.log("开始发送消息到后端..."),await jt.sendToBackend([{role:"user",content:v}],c=>{console.log("接收到流式数据块:",c),n("send-message",{type:"ai",content:c}),console.log("AI消息块已发送到前端")}),console.log("流式数据发送完成")}catch(c){console.error("发送消息到后端失败:",c)}};return(v,c)=>{const w=L("van-uploader"),h=L("van-button"),g=L("van-field");return C(),_("div",Ft,[l(w,{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=m=>i.value=m),"max-count":1,"preview-size":"60",disabled:""},null,8,["modelValue"]),b("div",Ht,[l(h,{size:"small",type:"default"},{default:P(()=>[...c[2]||(c[2]=[x("查询火车票",-1)])]),_:1}),l(h,{size:"small",type:"default"},{default:P(()=>[...c[3]||(c[3]=[x("查询天气",-1)])]),_:1}),l(w,null,{default:P(()=>[l(h,{size:"small",type:"default"},{default:P(()=>[...c[4]||(c[4]=[x("上传文件",-1)])]),_:1})]),_:1}),l(h,{size:"small",type:"default",onClick:u},{default:P(()=>[...c[5]||(c[5]=[x("一键投诉",-1)])]),_:1}),l(h,{size:"small",type:"default",onClick:d},{default:P(()=>[...c[6]||(c[6]=[x("清空记录",-1)])]),_:1})]),b("div",Wt,[l(g,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=m=>r.value=m),class:"input-content",type:"textarea",placeholder:"请输入询问内容",border:!1},null,8,["modelValue"]),l(h,{class:"send-button",size:"small",type:"default",onClick:f},{default:P(()=>[...c[7]||(c[7]=[x("发送",-1)])]),_:1})])])}}},Ut=M(Kt,[["__scopeId","data-v-17f6d447"]]),Jt={__name:"home",setup(e){const t=D(null),n=D(null),o=i=>{if(i.type==="clear"){a();return}t.value?(console.log("调用 addMessage"),t.value.addMessage(i)):console.error("chatMessageRef 为空")},a=()=>{var i,r;if(n.value){const u=((r=(i=t.value)==null?void 0:i.$el)==null?void 0:r.scrollHeight)||0,d=Math.max(200,u+50);n.value.style.paddingBottom=`${d}px`}};return he(()=>{a(),window.addEventListener("resize",a)}),Qe(()=>{window.removeEventListener("resize",a)}),(i,r)=>(C(),_("div",{class:"content",ref_key:"contentRef",ref:n},[l(gt),l(vt),l(kt,{ref_key:"chatMessageRef",ref:t,onMessagesChange:a},null,512),l(Ut,{onSendMessage:o})],512))}},Xt=M(Jt,[["__scopeId","data-v-36ee1d7e"]]);export{Xt as default};
