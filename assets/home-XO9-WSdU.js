import{_ as M,c as h,o as y,a as m,b as O,r as z,d as v,e as S,w as b,u as R,f as T,g as B,h as H,F as J,i as L,j as N,t as P,k as q,l as U}from"./index-CnC1o-lt.js";const C="/deepseek_travel/assets/%E7%8C%AB-nHbXJ-ix.jpg",W={};function D(g,e){return y(),h("div",null,[...e[0]||(e[0]=[m("div",{class:"main-header"},[m("div",null,[m("p",{class:"name-field"},"Hi,我是云游小助手"),m("p",{class:"intro-section"},"你的江西专属云游助手，可以帮你规划行程和解答出游问题哦")]),m("div",null,[m("img",{src:C,alt:""})])],-1)])])}const F=M(W,[["render",D]]),x="/deepseek_travel/assets/%E5%A4%B4%E5%83%8F-CEvM-Wqj.jpg",G={};function K(g,e){return y(),h("div",null,[...e[0]||(e[0]=[O('<div class="support-agent" data-v-aeb76c9d><img src="'+x+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>云游宝</p></div><div class="customer-service" data-v-aeb76c9d><span data-v-aeb76c9d>你可以这样问我</span><div class="custome-service-list" data-v-aeb76c9d><img src="'+x+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>你好，你能做什么</p></div><div class="custome-service-list" data-v-aeb76c9d><img src="'+x+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>你好，帮我查询上海1.1号的天气</p></div><div class="custome-service-list" data-v-aeb76c9d><img src="'+x+'" alt="" data-v-aeb76c9d><p data-v-aeb76c9d>你好，帮我查询1.12号从上海到赣州的火车票</p></div></div><div class="change-section" data-v-aeb76c9d><p data-v-aeb76c9d>换一换</p></div>',3)])])}const Q=M(G,[["render",K],["__scopeId","data-v-aeb76c9d"]]),A="http://localhost:7000",I={async queryTrainTickets(g,e){try{const a={start:g,end:e};console.log("前端发送火车票查询请求:",{url:`${A}/tool/trainTickets`,body:a});const o=await fetch(`${A}/tool/trainTickets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const l=await o.json();return console.log("前端收到火车票查询响应:",l),l}catch(a){throw console.error("查询火车票失败:",a),a}},async getWeather(g){try{const e=await fetch(`${A}/tool/weather`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({city:g})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){throw console.error("查询天气失败:",e),e}}},X="http://localhost:7000",Y={async sendToBackend(g,e){try{const a=await fetch(`${X}/chatMessage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chatMessage:g})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const o=a.body.getReader(),l=new TextDecoder;let c="";for(;;){const{done:_,value:n}=await o.read();if(_)break;const s=l.decode(n).split(`
`).filter(f=>f.trim());for(const f of s)try{const r=JSON.parse(f);if(r.type==="content")c+=r.data,e&&e(r.data);else if(r.type==="function"){if(console.log("收到工具调用:",r.functionName,r.data),r.functionName==="trainTickets"){const{departure:$,destination:u}=r.data;console.log("调用火车票查询API:",$,u);try{const p=await I.queryTrainTickets($,u);console.log("火车票查询结果:",p);let i="";if(p&&p.data&&p.data.list){const E=p.data.list;i+=`找到 ${E.length} 趟火车票：

`,E.forEach((t,j)=>{i+=`${j+1}. ${t.trainno} (${t.type})
`,i+=`   ${t.departstation} ${t.departuretime} → ${t.terminalstation} ${t.arrivaltime}
`,i+=`   用时：${t.costtime}
`;const w=[];t.yz&&t.yz.price!=="--"&&w.push(`硬座 ¥${t.yz.price}`),t.ze&&t.ze.price!=="--"&&w.push(`二等座 ¥${t.ze.price}`),t.zy&&t.zy.price!=="--"&&w.push(`一等座 ¥${t.zy.price}`),t.swz&&t.swz.price!=="--"&&w.push(`商务座 ¥${t.swz.price}`),t.yw&&t.yw.price!=="--"&&w.push(`硬卧 ¥${t.yw.price}`),t.rw&&t.rw.price!=="--"&&w.push(`软卧 ¥${t.rw.price}`),w.length>0&&(i+=`   票价：${w.join("、")}
`),i+=`
`})}else i="未查询到符合条件的火车票";e&&e(i)}catch(p){console.error("查询火车票失败:",p),e&&e("查询火车票失败，请稍后重试")}}else if(r.functionName==="getWeather"){const{city:$}=r.data;console.log("调用天气查询API:",$);try{const u=await I.getWeather($);console.log("天气查询结果:",u);let p="";if(u&&u.data){const i=u.data;p+=`${i.city} ${i.temperature} ${i.weather}
`,p+=`风力：${i.wind}
`,p+=`湿度：${i.humidity}`}else p="查询天气失败";e&&e(p)}catch(u){console.error("查询天气失败:",u),e&&e("查询天气失败，请稍后重试")}}}}catch(r){console.error("解析错误:",r)}}return c}catch(a){throw console.error("发送消息失败:",a),a}}},Z={class:"input-container"},k={class:"data-query"},ee={class:"input-box-area"},te={__name:"inputArea",emits:["send-message"],setup(g,{emit:e}){const a=e,o=R(),l=z([]),c=z(""),_=()=>{o.push("/complaintPage")},n=async()=>{if(!c.value.trim())return;const d=c.value;c.value="",a("send-message",{type:"user",content:d});try{console.log("开始发送消息到后端..."),await Y.sendToBackend([{role:"user",content:d}],s=>{console.log("接收到流式数据块:",s),a("send-message",{type:"ai",content:s}),console.log("AI消息块已发送到前端")}),console.log("流式数据发送完成")}catch(s){console.error("发送消息到后端失败:",s)}};return(d,s)=>{const f=S("van-uploader"),r=S("van-button"),$=S("van-field");return y(),h("div",Z,[v(f,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=u=>l.value=u),"max-count":1,"preview-size":"60",disabled:""},null,8,["modelValue"]),m("div",k,[v(r,{size:"small",type:"default"},{default:b(()=>[...s[2]||(s[2]=[T("查询火车票",-1)])]),_:1}),v(r,{size:"small",type:"default"},{default:b(()=>[...s[3]||(s[3]=[T("查询天气",-1)])]),_:1}),v(f,null,{default:b(()=>[v(r,{size:"small",type:"default"},{default:b(()=>[...s[4]||(s[4]=[T("上传文件",-1)])]),_:1})]),_:1}),v(r,{size:"small",type:"default",onClick:_},{default:b(()=>[...s[5]||(s[5]=[T("一键投诉",-1)])]),_:1})]),m("div",ee,[v($,{modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=u=>c.value=u),class:"input-content",type:"textarea",placeholder:"请输入询问内容",border:!1},null,8,["modelValue"]),v(r,{class:"send-button",size:"small",type:"default",onClick:n},{default:b(()=>[...s[6]||(s[6]=[T("发送",-1)])]),_:1})])])}}},se=M(te,[["__scopeId","data-v-11b25d40"]]),ae={class:"chat-message"},oe={key:0,class:"user-message-container"},ne={class:"user-message"},re={key:1,class:"ai-message"},ce={class:"mark-text"},V="chat_messages",le={__name:"chatMessage",emits:["messages-change"],setup(g,{expose:e,emit:a}){const o=z([]),l=a;B(()=>{const n=localStorage.getItem(V);if(n)try{o.value=JSON.parse(n)}catch(d){console.error("读取历史消息失败:",d)}}),H(o,()=>{l("messages-change")});const c=n=>{if(console.log("addMessage 被调用"),console.log("接收到的消息:",n),n.type==="user")o.value.push(n);else if(n.type==="ai"){const d=o.value[o.value.length-1];d&&d.type==="ai"?d.content+=n.content:o.value.push(n)}else n.type==="function"&&o.value.push(n);console.log("当前消息列表:",o.value),_()},_=()=>{try{localStorage.setItem(V,JSON.stringify(o.value))}catch(n){console.error("保存消息失败:",n)}};return e({addMessage:c}),(n,d)=>{const s=S("van-image");return y(),h("div",ae,[(y(!0),h(J,null,L(o.value,(f,r)=>(y(),h("div",{key:r},[f.type==="user"?(y(),h("div",oe,[m("div",ne,[m("p",null,P(f.content),1)]),v(s,{class:"user-avatar",width:"40px",height:"40px",radius:"50%",fit:"cover",src:q(x)},null,8,["src"])])):N("",!0),f.type==="ai"?(y(),h("div",re,[m("div",ce,P(f.content),1)])):N("",!0)]))),128))])}}},ie=M(le,[["__scopeId","data-v-7d344036"]]),de={__name:"home",setup(g){const e=z(null),a=z(null),o=c=>{e.value?(console.log("调用 addMessage"),e.value.addMessage(c)):console.error("chatMessageRef 为空")},l=()=>{var c,_;if(a.value){const n=((_=(c=e.value)==null?void 0:c.$el)==null?void 0:_.scrollHeight)||0,d=Math.max(200,n+50);a.value.style.paddingBottom=`${d}px`}};return B(()=>{l(),window.addEventListener("resize",l)}),U(()=>{window.removeEventListener("resize",l)}),(c,_)=>(y(),h("div",{class:"content",ref_key:"contentRef",ref:a},[v(F),v(Q),v(ie,{ref_key:"chatMessageRef",ref:e,onMessagesChange:l},null,512),v(se,{onSendMessage:o})],512))}},pe=M(de,[["__scopeId","data-v-4e3abc62"]]);export{pe as default};
